# 월드 기반 개인 서버 아키텍처 설계 문서 (초안)

### 1. 진입 구조

#### 1.1 접속 엔드포인트

- 모든 유저는 `servername.example.com`을 통해 접속한다.
- 해당 주소는 항상 로비 서버로 연결된다.
- IP 주소 및 포트 번호는 유저에게 노출하지 않는다.

### 1.2 진입 원칙

- 서버 및 월드 선택은 게임 내부 로비 UI에서만 이루어진다.
- 외부 주소 입력 단계에서는 어떤 월드에도 직접 연결되지 않는다.
- 로비는 서비스의 **유일한 진입점(Single Entry Point)** 이다.

---

### 2. 로비 서버의 역할

로비 서버는 플레이 공간이 아닌 **서비스 허브**로 동작한다.

#### 2.1 주요 기능

- 내 월드 목록 표시
- 새 월드 생성
- 친구 목록 / 초대 관리
- 다른 유저의 월드 탐색 및 입장

#### 2.2 로비의 책임 범위

- 월드/서버 상태 조회
- 서버 생성 요청 트리거
- 서버 이동 라우팅

로비 서버 자체에서는 실제 플레이가 이루어지지 않는다.

---

### 3. 서버 구조

#### 3.1 유저 전용 서버 인스턴스

- 각 유저는 **전용 서버 인스턴스 1개**를 할당받는다.
- 서버 인스턴스는 유저의 월드들을 실행하기 위한 컨테이너 역할을 한다.
- 서버 인스턴스는 필요 시 자동 생성되며, 수동 관리 대상이 아니다.

#### 3.2 서버 내부 월드 구조

- 하나의 서버 인스턴스 내부에는 월드 인스턴스를 최대 3개까지 생성할 수 있다.
- 월드 인스턴스는 다음 조건을 따른다:
  - 플레이어가 있을 때만 로드
  - 플레이어가 없으면 언로드 가능
- 월드 인스턴스는 서버 프로세스를 공유하며, 서버 단위로 자원을 사용한다.

---

### 4. 서버 생명주기 관리

#### 4.1 서버 기동 조건

- 유저 또는 초대된 친구가 월드에 입장할 경우
- 해당 유저의 서버 인스턴스가 자동으로 기동된다.

#### 4.2 서버 종료 조건

- 서버 내 모든 월드에 플레이어가 없는 상태가 일정 시간 지속될 경우
- 서버 인스턴스는 자동으로 종료된다.

#### 4.3 관리 방식

- 서버의 시작/종료는 유저 행동 기반 자동화를 원칙으로 한다.
- 관리자의 수동 개입은 예외 상황에서만 허용된다.

---

### 5. 친구 시스템 설계 방향

#### 5.1 친구의 개념

- 친구는 월드 접근 권한을 공유받은 유저를 의미한다.
- 서버 소유권은 항상 월드 생성 유저에게 있다.

#### 5.2 친구 관련 기능

- 친구 추가 / 삭제
- 월드 단위 접근 허용 설정
- 친구 접속 시 서버 자동 기동

#### 5.3 구조적 특징

- 친구 기능은 기존 서버/월드 구조 위에 권한 레이어로 추가된다.
- 서버 구조 자체를 변경하지 않고 기능 확장이 가능하다.

---

### 6. 관리자 역할 정의

#### 6.1 기본 원칙

- 관리자는 서버를 “운영”하지 않는다.
- 시스템 자동화 상태를 감시하고 예외 상황만 처리한다.

#### 6.2 관리자 권한

- 서버 상태 모니터링
- 비정상 서버 강제 종료
- 장애 복구

관리자 수동 조작은 로그 및 경고 절차를 필수로 한다.

---

### 7. 구조 요약

- 단일 진입 주소 기반 로비 구조
- 유저당 전용 서버 인스턴스
- 서버 내부 다중 월드 인스턴스
- 유저 행동 기반 서버 생명주기
- 친구 시스템은 접근 권한 확장으로 처리

이 구조는 **서버 운영을 유저 경험에서 완전히 분리**하고,
월드 중심의 서비스형 게임 구조를 목표로 한다.

---

### 8. 현재 상태

- 아키텍처의 큰 틀 확정
- 진입 방식 / 서버 단위 / 월드 단위 명확화 완료
- 이후 기능 확장은 본 구조를 유지한 채 단계적으로 추가 가능
